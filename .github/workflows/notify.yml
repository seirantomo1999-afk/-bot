name: park_notifier

on:
  workflow_dispatch: {}     # 手動実行（テストに便利）
  schedule:
    # GitHub Actions は UTC で動作。JST 7:00–24:00 は UTC 22:00–15:00
    - cron: "*/15 22-23 * * *"   # JST 7:00–8:45
    - cron: "*/15 0-15 * * *"    # JST 9:00–24:00

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Check out
        uses: actions/checkout@v4

      - name: Install Google Chrome
        uses: browser-actions/setup-chrome@v1

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install selenium webdriver-manager beautifulsoup4 jpholiday \
                      google-api-python-client google-auth-httplib2 google-auth-oauthlib

      - name: Restore credentials.json/token.json from Secrets
        run: |
          echo "$GMAIL_CREDENTIALS_JSON" > credentials.json
          echo "$GMAIL_TOKEN_JSON" > token.json
        env:
          GMAIL_CREDENTIALS_JSON: ${{ secrets.GMAIL_CREDENTIALS_JSON }}
          GMAIL_TOKEN_JSON: ${{ secrets.GMAIL_TOKEN_JSON }}

      - name: Run notifier
        env:
          GITHUB_ACTIONS: "true"   # ヘッドレス切り替え用
        run: python gmail.py
